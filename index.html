<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EPS</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4f46e5">
<style>
:root { --bg1:#1e3a8a; --bg2:#2563eb; }
.light { --bg1:#e0f2fe; --bg2:#bae6fd; }
body { background:linear-gradient(135deg,var(--bg1),var(--bg2)); min-height:100vh;color:white; }
.card { border-radius:1rem; padding:1rem; transition: transform 0.2s, box-shadow 0.2s; display:flex; flex-direction:column; justify-content:space-between; }
.card:hover { transform:scale(1.03); box-shadow:0 8px 20px rgba(0,0,0,0.3); }
.card button.open-btn { flex:1; background: linear-gradient(90deg,#4f46e5,#6366f1); color:white; border-radius:0.5rem; padding:0.5rem 1rem; font-weight:bold; transition: background 0.2s; }
.card button.open-btn:hover { background: linear-gradient(90deg,#6366f1,#4f46e5); }
.emoji-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(40px,1fr)); gap:5px; max-height:150px; overflow:auto; margin-bottom:0.5rem; }
.emoji-grid button { font-size:1.5rem; cursor:pointer; transition:0.2s; }
.emoji-grid button:hover { transform:scale(1.2); }
</style>
<head>
<link rel="stylesheet" href="darkmode.css">
  
<header class="text-center mb-4">
<h1 class="text-4xl font-bold">EPS</h1>
<p class="opacity-80">by T.Bourgouin</p>
</header>

<!-- CONTROLES -->
<div class="flex flex-wrap gap-2 justify-center mb-4">
<button id="themeBtn" class="bg-white text-black px-3 py-1 rounded">ğŸŒ— ThÃ¨me</button>
<button id="exportBtn" class="bg-white text-black px-3 py-1 rounded">ğŸ“¤ Export</button>
<label class="bg-white text-black px-3 py-1 rounded cursor-pointer">
ğŸ“¥ Import<input type="file" hidden id="importInput">
</label>
</div>

<!-- AJOUT -->
<div class="grid sm:grid-cols-6 gap-2 mb-2">
<input id="name" placeholder="Nom" class="p-2 rounded text-black">
<input id="url" placeholder="Lien" class="p-2 rounded text-black">
<input id="cat" placeholder="CatÃ©gorie" class="p-2 rounded text-black">
<input id="icon" placeholder="Emoji" class="p-2 rounded text-black" readonly>
<input id="color" type="color" value="#4f46e5" class="h-10">
<button id="addBtn" type="button" class="bg-white text-black rounded font-bold mt-2">â• Ajouter</button>
</div>

<!-- MENU EMOJIS COLLAPSIBLE -->
<div class="mb-2">
  <button id="toggleEmoji" class="bg-white text-black px-2 py-1 rounded mb-1">ğŸ˜€ Emojis</button>
  <div class="emoji-grid hidden" id="emojiGrid"></div>
</div>

<!-- FILTRES -->
<div class="flex gap-2 mb-4">
<input id="search" placeholder="ğŸ” Rechercher" class="flex-1 p-2 rounded text-black">
<select id="filterCat" class="p-2 rounded text-black">
<option value="">Toutes catÃ©gories</option>
</select>
</div>

<!-- CARTES -->
<div id="apps" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>

</div>

<script>
// THEME
let theme = localStorage.getItem("theme")||"dark";
if(theme==="light") document.body.classList.add("light");
document.getElementById("themeBtn").addEventListener("click", () => {
    theme = theme==="dark"?"light":"dark";
    document.body.classList.toggle("light");
    localStorage.setItem("theme", theme);
});

// DONNÃ‰ES
let apps = JSON.parse(localStorage.getItem("hubApps")||"[]");

// Natives simplifiÃ©es
const nativeApps = [
  { name: "Google Drive", url: "https://drive.google.com", icon: "ğŸ“‚", cat: "Native", color: "#34d399" },
  { name: "Google Docs", url: "https://docs.google.com", icon: "ğŸ“„", cat: "Native", color: "#3b82f6" }
];
let added=false;
nativeApps.forEach(n=>{
  if(!apps.some(a=>a.name===n.name && a.cat==="Native")){ apps.push(n); added=true; }
});
if(added) localStorage.setItem("hubApps", JSON.stringify(apps));

// EMOJIS
const emojis = ["ğŸƒâ€â™‚ï¸","ğŸƒâ€â™€ï¸","â±ï¸","ğŸ“‚","ğŸ“„","ğŸ¯","ğŸ“š","ğŸ§­","ğŸ”¢","âš¡","ğŸ“","ğŸ“·","ğŸµ","ğŸŒŸ","ğŸ–Šï¸","ğŸ—‚ï¸","ğŸ“Š","ğŸ“Œ","ğŸ“…","ğŸ› ï¸","ğŸ§©","ğŸ’","ğŸ““","ğŸ—’ï¸","ğŸ•¹ï¸","ğŸ›ï¸","ğŸ§°","ğŸ–ï¸","ğŸ¤","ğŸ…","ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰","ğŸ—‘ï¸","ğŸ’¡","ğŸ§¾","ğŸ”","ğŸ””","ğŸ“","ğŸ«","ğŸ”—","ğŸ–¥ï¸","ğŸ“²"];
const emojiGrid=document.getElementById("emojiGrid");
const iconInput=document.getElementById("icon");
emojis.forEach(e=>{
  const btn=document.createElement("button");
  btn.innerText=e;
  btn.type="button";
  btn.addEventListener("click", ()=>{ iconInput.value=e; iconInput.focus(); });
  emojiGrid.appendChild(btn);
});
document.getElementById("toggleEmoji").addEventListener("click", ()=>{
  emojiGrid.classList.toggle("hidden");
});

// AJOUT APP
document.getElementById("addBtn").addEventListener("click", ()=>{
    const name = document.getElementById("name").value.trim();
    const url = document.getElementById("url").value.trim();
    const cat = document.getElementById("cat").value.trim();
    const icon = iconInput.value || "ğŸ”—";
    const color = document.getElementById("color").value;
    if(!name||!url){ alert("Nom et lien obligatoires"); return; }
    apps.push({id:Date.now(), name, url, cat, icon, color, fav:false});
    localStorage.setItem("hubApps", JSON.stringify(apps));
    document.getElementById("name").value="";
    document.getElementById("url").value="";
    document.getElementById("cat").value="";
    iconInput.value="";
    render();
});

// RENDER CARTES
let dragIndex=null;
function render(){
    const list=document.getElementById("apps");
    const cats=[...new Set(apps.map(a=>a.cat).filter(Boolean))];
    document.getElementById("filterCat").innerHTML='<option value="">Toutes catÃ©gories</option>'+cats.map(c=>`<option>${c}</option>`).join("");
    
    const search=document.getElementById("search").value.toLowerCase();
    const filterCat=document.getElementById("filterCat").value;
    
    list.innerHTML="";
    apps
      .filter(a => a.name.toLowerCase().includes(search))
      .filter(a => !filterCat || a.cat===filterCat)
      .sort((a,b)=>b.fav-a.fav)
      .forEach((a,i)=>{
        const card=document.createElement("div");
        card.className="card p-4 shadow";
        card.draggable=true;
        card.style.background=a.color;
        card.ondragstart=()=>dragStart(i);
        card.ondragover=(e)=>e.preventDefault();
        card.ondrop=()=>drop(i);

        card.innerHTML=`
            <div class="text-3xl mb-2">${a.icon}</div>
            <h2 class="text-xl font-bold mb-1">${a.name}</h2>
            <p class="text-sm opacity-80 mb-2">${a.cat||""}</p>
            <div class="flex gap-2">
                <button class="open-btn">Ouvrir</button>
                <button class="fav-btn">â­</button>
                <button class="del-btn">ğŸ—‘ï¸</button>
            </div>
        `;
        list.appendChild(card);

        card.querySelector(".open-btn").addEventListener("click", ()=>window.open(a.url,"_blank"));
        card.querySelector(".fav-btn").addEventListener("click", ()=>{ a.fav^=1; localStorage.setItem("hubApps", JSON.stringify(apps)); render(); });
        card.querySelector(".del-btn").addEventListener("click", ()=>{
            if(a.cat==="Native"){ alert("Impossible de supprimer une appli native"); return; }
            if(confirm("Supprimer ?")){ apps=apps.filter(app=>app.id!==a.id); localStorage.setItem("hubApps", JSON.stringify(apps)); render(); }
        });
    });
}

// DRAG & DROP
function dragStart(i){dragIndex=i;}
function drop(i){ if(dragIndex===null) return; const moved=apps.splice(dragIndex,1)[0]; apps.splice(i,0,moved); dragIndex=null; localStorage.setItem("hubApps", JSON.stringify(apps)); render(); }

// EXPORT / IMPORT
document.getElementById("exportBtn").addEventListener("click", ()=>{
    const blob=new Blob([JSON.stringify(apps)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="hub-backup.json";
    a.click();
});
document.getElementById("importInput").addEventListener("change", e=>{
    const r=new FileReader();
    r.onload=()=>{ apps=JSON.parse(r.result); localStorage.setItem("hubApps", JSON.stringify(apps)); render(); };
    r.readAsText(e.target.files[0]);
});

// INITIAL RENDER
render();

// ====================
// SERVICE WORKER PWA
// ====================
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./service-worker.js')
  .then(()=>console.log("Service Worker OK"))
  .catch(err=>console.log("Service Worker KO",err));
}
</script>
</body>
</html>

